<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TP.HCM - Kinh t·∫ø - Kh√≠ h·∫≠u</title>
  <style>
    :root {
      --accent: #0078ff;
      --accent-light: #cce4ff;
      --bg: #f2f7fb;
      --card: #fff;
    }
    * { box-sizing: border-box; transition: all .4s ease; }
    body {
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
      margin: 0; background: var(--bg); color: #0b2233;
      overflow-x: hidden;
    }
    header {
      background: linear-gradient(135deg, var(--accent), #00b7ff);
      color: white; padding: 60px 20px; text-align: center;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }
    h1 {
      margin: 0; font-size: 48px;
      animation: fadeInText 2s ease-in-out forwards, glow 2s infinite alternate;
    }

    @keyframes fadeInText {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes glow {
      from { text-shadow: 0 0 10px #80d8ff, 0 0 20px #00b7ff; }
      to { text-shadow: 0 0 25px #cce4ff, 0 0 40px #0078ff; }
    }

    main { display: flex; justify-content: center; align-items: center; height: calc(100vh - 160px); }
    .card {
      background: var(--card); padding: 40px; border-radius: 18px;
      box-shadow: 0 6px 25px rgba(0,0,0,0.08);
      max-width: 800px; width: 90%; text-align: left;
      opacity: 0; transform: scale(0.98);
    }
    .fade-in { animation: fadeIn .6s forwards; }
    .fade-out { animation: fadeOut .4s forwards; }
    .shake { animation: shake 0.4s ease; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-20px); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-8px); }
      40%, 80% { transform: translateX(8px); }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); color: #ff9f0a; }
      100% { transform: scale(1); }
    }

    @keyframes glowText {
      0%, 100% { text-shadow: 0 0 10px #ffd700, 0 0 20px #ffec8b; }
      50% { text-shadow: 0 0 25px #fff176, 0 0 40px #fff59d; }
    }

    .options { list-style: none; padding: 0; margin: 20px 0; }
    .options li { margin-bottom: 14px; }
    label.option {
      display: block; padding: 18px; border-radius: 12px;
      border: 1px solid #dde9f3; background: #fafcff; cursor: pointer;
      font-size: 20px;
    }
    label.option:hover { background: var(--accent-light); }
    input[type=radio] { margin-right: 12px; transform: scale(1.3); }

    .btn {
      padding: 14px 22px; border-radius: 12px; border: none;
      background: var(--accent); color: #fff; font-weight: 600; cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,120,255,0.3);
      font-size: 20px;
    }
    .btn:hover { background: #0063cc; }

    .score { font-size: 22px; font-weight: bold; margin-top: 20px; text-align: center; }
    .streak { font-size: 20px; text-align: right; color: #0078ff; font-weight: 600; margin-bottom: 14px; }
    .streak.animate { animation: pulse 0.6s ease; }
    .correct { background: #e6ffef; border-color: #8cd6a6; }
    .wrong { background: #ffe8e8; border-color: #f3b1b1; }

    #music-toggle {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 36px; /* K√≠ch th∆∞·ªõc bi·ªÉu t∆∞·ª£ng */
      cursor: pointer;
      color: #fff; /* M√†u bi·ªÉu t∆∞·ª£ng */
      text-shadow: 0 2px 5px rgba(0,0,0,0.3); /* T·∫°o hi·ªáu ·ª©ng ƒë·ªï b√≥ng cho bi·ªÉu t∆∞·ª£ng */
      z-index: 1000; /* ƒê·∫£m b·∫£o bi·ªÉu t∆∞·ª£ng n·∫±m tr√™n c√πng */
    }
    #music-toggle:hover {
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <header>
    <h1>TP.HCM - Kinh t·∫ø - Kh√≠ h·∫≠u</h1>
  </header>

  <main>
    <div class="card fade-in" id="quiz-container">
      <div class="streak" id="streak-display">üî• Chu·ªói ƒë√∫ng: 0</div>
      <h2 id="question-text" style="font-size:26px;"></h2>
      <ul class="options" id="options-list"></ul>
      <button class="btn" id="next-btn" style="display:none;">C√¢u ti·∫øp theo ‚ûú</button>
      <div id="result" class="score"></div>
    </div>
  </main>

  <div id="music-toggle">üîä</div> <audio id="background-music" src="soft-piano-music-312509.mp3" loop></audio>
  <audio id="correct-sound" src="training-program-correct1-105916.mp3"></audio>
  <audio id="wrong-sound" src="error-04-199275.mp3"></audio>
  <audio id="finish-sound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_9f6c5686b9.mp3"></audio>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    const QUESTIONS = [
      {q:"Nguy√™n nh√¢n n√†o sau ƒë√¢y kh√¥ng thu·ªôc bi·∫øn ƒë·ªông kinh t·∫ø to√†n c·∫ßu ·∫£nh h∆∞·ªüng ƒë·∫øn TP.HCM?", opts:["Chi·∫øn tranh th∆∞∆°ng m·∫°i M·ªπ‚ÄìTrung","Suy tho√°i kinh t·∫ø th·∫ø gi·ªõi","M∆∞a l·ªõn, ng·∫≠p √∫ng k√©o d√†i"], a:2},
      {q:"ƒê·∫°i d·ªãch COVID-19 g√¢y ra t√°c ƒë·ªông l·ªõn nh·∫•t n√†o ƒë·ªëi v·ªõi n·ªÅn kinh t·∫ø TP.HCM?", opts:["Gi√°n ƒëo·∫°n chu·ªói cung ·ª©ng v√† du l·ªãch","TƒÉng d√¢n s·ªë th√†nh ph·ªë","Gi·∫£m m·ª©c ƒë·ªô h·ªôi nh·∫≠p qu·ªëc t·∫ø"], a:0},
      {q:"Cu·ªôc C√°ch m·∫°ng c√¥ng nghi·ªáp 4.0 khi·∫øn TP.HCM ph·∫£i ƒë·ªëi m·∫∑t v·ªõi th√°ch th·ª©c g√¨?", opts:["Thi·∫øu ngu·ªìn t√†i nguy√™n thi√™n nhi√™n","√Åp l·ª±c th√≠ch ·ª©ng c√¥ng ngh·ªá v√† chuy·ªÉn ƒë·ªïi s·ªë","Gi·∫£m d√¢n s·ªë lao ƒë·ªông"], a:1},
      {q:"T·ªëc ƒë·ªô ƒë√¥ th·ªã h√≥a nhanh g√¢y ra h·ªá qu·∫£ n√†o sau ƒë√¢y?", opts:["D√¢n s·ªë gi·∫£m m·∫°nh","√Åp l·ª±c l√™n giao th√¥ng, y t·∫ø v√† nh√† ·ªü","TƒÉng t·ª∑ l·ªá r·ª´ng t·ª± nhi√™n"], a:1},
      {q:"Bi·∫øn ƒë·ªïi kh√≠ h·∫≠u v√† ng·∫≠p l·ª•t ·∫£nh h∆∞·ªüng ƒë·∫øn kinh t·∫ø TP.HCM nh∆∞ th·∫ø n√†o?", opts:["L√†m tƒÉng nƒÉng su·∫•t lao ƒë·ªông","Gi·∫£m chi ph√≠ v·∫≠n chuy·ªÉn h√†ng h√≥a","L√†m h∆∞ h·ªèng h·∫° t·∫ßng, gi√°n ƒëo·∫°n s·∫£n xu·∫•t"], a:2},
      {q:"V·ªÅ t√°c ƒë·ªông x√£ h·ªôi, ƒëi·ªÅu g√¨ kh√¥ng ph·∫£i l√† h·∫≠u qu·∫£ c·ªßa thi√™n tai ‚Äì bi·∫øn ƒë·ªïi kh√≠ h·∫≠u t·∫°i TP.HCM?", opts:["Gia tƒÉng d·ªãch b·ªánh","Di c∆∞ kh·ªèi v√πng ng·∫≠p","M·ªü r·ªông r·ª´ng ng·∫≠p m·∫∑n t·ª± nhi√™n trong ƒë√¥ th·ªã"], a:2}
    ];

    let current = 0;
    let score = 0;
    let streak = 0;
    let maxStreak = 0;
    let musicInitialized = false; 
    let isMusicPlaying = false; // Theo d√µi tr·∫°ng th√°i nh·∫°c n·ªÅn

    const container = document.getElementById('quiz-container');
    const questionText = document.getElementById('question-text');
    const optionsList = document.getElementById('options-list');
    const resultDiv = document.getElementById('result');
    const nextBtn = document.getElementById('next-btn');
    const streakDisplay = document.getElementById('streak-display');
    const soundCorrect = document.getElementById('correct-sound');
    const soundWrong = document.getElementById('wrong-sound');
    const soundFinish = document.getElementById('finish-sound');
    const backgroundMusic = document.getElementById('background-music');
    const musicToggleBtn = document.getElementById('music-toggle'); // L·∫•y bi·ªÉu t∆∞·ª£ng loa

    // C·∫≠p nh·∫≠t tr·∫°ng th√°i bi·ªÉu t∆∞·ª£ng loa
    function updateMusicToggleButton() {
        musicToggleBtn.textContent = isMusicPlaying ? 'üîä' : 'üîá';
    }

    // H√†m ƒë·∫£m b·∫£o nh·∫°c n·ªÅn b·∫Øt ƒë·∫ßu ph√°t sau t∆∞∆°ng t√°c ƒë·∫ßu ti√™n
    function initializeMusic() {
        if (!musicInitialized) {
            backgroundMusic.volume = 0.3; // Gi·∫£m √¢m l∆∞·ª£ng nh·∫°c n·ªÅn
            backgroundMusic.play().then(() => {
                isMusicPlaying = true;
                updateMusicToggleButton();
            }).catch(e => {
                console.log("Autoplay blocked. Music will play after the first interaction.");
                isMusicPlaying = false; // ƒê·∫£m b·∫£o c·ªù ƒë∆∞·ª£c ƒë·∫∑t ƒë√∫ng n·∫øu kh√¥ng ph√°t ƒë∆∞·ª£c
                updateMusicToggleButton();
            });
            musicInitialized = true;
        }
    }

    // X·ª≠ l√Ω s·ª± ki·ªán click v√†o bi·ªÉu t∆∞·ª£ng loa
    musicToggleBtn.addEventListener('click', () => {
        if (isMusicPlaying) {
            backgroundMusic.pause();
            isMusicPlaying = false;
        } else {
            backgroundMusic.play().then(() => {
                isMusicPlaying = true;
            }).catch(e => {
                console.log("Failed to play music on toggle click.");
                isMusicPlaying = false; // ƒê·∫£m b·∫£o c·ªù ƒë∆∞·ª£c ƒë·∫∑t ƒë√∫ng n·∫øu kh√¥ng ph√°t ƒë∆∞·ª£c
            });
        }
        updateMusicToggleButton();
    });

    function updateStreakDisplay() {
      streakDisplay.textContent = streak > 0 ? `üî• Chu·ªói ƒë√∫ng: ${streak}` : '‚ùÑÔ∏è Chu·ªói b·ªã ng·∫Øt';
      streakDisplay.classList.add('animate');
      setTimeout(()=> streakDisplay.classList.remove('animate'), 700);
    }

    function fadeTransition(callback) {
      container.classList.remove('fade-in');
      container.classList.add('fade-out');
      setTimeout(() => {
        callback();
        container.classList.remove('fade-out');
        container.classList.add('fade-in');
      }, 400);
    }

    function loadQuestion() {
      const q = QUESTIONS[current];
      questionText.textContent = `C√¢u ${current+1}/${QUESTIONS.length}: ${q.q}`;
      optionsList.innerHTML = '';
      resultDiv.textContent = '';
      nextBtn.style.display = 'none';
      updateStreakDisplay();

      q.opts.forEach((opt, i) => {
        const li = document.createElement('li');
        li.innerHTML = `<label class='option'><input type='radio' name='option' value='${i}'>${opt}</label>`;
        optionsList.appendChild(li);
      });

      const radios = optionsList.querySelectorAll('input[type=radio]');
      radios.forEach(r => r.addEventListener('change', () => checkAnswer(Number(r.value))));
    }

    function checkAnswer(selected) {
      // ‚ûî B·∫Øt ƒë·∫ßu ph√°t nh·∫°c n·ªÅn ngay khi ng∆∞·ªùi d√πng ch·ªçn ƒë√°p √°n ƒë·∫ßu ti√™n
      initializeMusic(); 
      
      const correct = QUESTIONS[current].a;
      const labels = optionsList.querySelectorAll('label.option');

      if (selected === correct) {
        labels[selected].classList.add('correct');
        soundCorrect.play();
        score++; streak++; maxStreak = Math.max(maxStreak, streak);
        resultDiv.textContent = '‚úÖ Ch√≠nh x√°c!';
      } else {
        labels[selected].classList.add('wrong');
        labels[correct].classList.add('correct');
        soundWrong.play();
        resultDiv.textContent = `‚ùå Sai r·ªìi! ƒê√°p √°n ƒë√∫ng l√†: ${QUESTIONS[current].opts[correct]}`;
        streak = 0;
        container.classList.add('shake');
        setTimeout(() => container.classList.remove('shake'), 400);
      }

      updateStreakDisplay();
      nextBtn.style.display = 'inline-block';
      optionsList.querySelectorAll('input').forEach(inp => inp.disabled = true);
    }

    nextBtn.addEventListener('click', () => {
      fadeTransition(() => {
        current++;
        if (current < QUESTIONS.length) {
          loadQuestion();
        } else {
          showFinal();
        }
      });
    });

    function showFinal() {
      backgroundMusic.pause();
      isMusicPlaying = false; // C·∫≠p nh·∫≠t tr·∫°ng th√°i khi nh·∫°c d·ª´ng
      updateMusicToggleButton(); // C·∫≠p nh·∫≠t bi·ªÉu t∆∞·ª£ng
      soundFinish.play();
      confetti({ particleCount: 200, spread: 90, origin: { y: 0.6 } });
      container.innerHTML = `<h2 style='font-size:32px; animation: glowText 1.5s infinite;'>üéâ Ho√†n th√†nh!</h2><p style='font-size:22px;'>B·∫°n ƒë√∫ng ${score}/${QUESTIONS.length} c√¢u.</p><p style='font-size:22px;'>üî• Chu·ªói ƒë√∫ng cao nh·∫•t: ${maxStreak}</p><button class='btn' onclick='restartQuiz()'>L√†m l·∫°i</button>`;
    }

    function restartQuiz() {
      fadeTransition(() => {
        current = 0; score = 0; streak = 0; maxStreak = 0;
        container.innerHTML = `<div class='streak' id='streak-display'>üî• Chu·ªói ƒë√∫ng: 0</div><h2 id='question-text' style='font-size:26px;'></h2><ul class='options' id='options-list'></ul><button class='btn' id='next-btn' style='display:none;'>C√¢u ti·∫øp theo ‚ûú</button><div id='result' class='score'></div>`;
        document.getElementById('next-btn').addEventListener('click', () => {
          fadeTransition(() => {
            current++;
            if(current < QUESTIONS.length) loadQuestion(); else showFinal();
          });
        });
        // Khi l√†m l·∫°i, ki·ªÉm tra n·∫øu nh·∫°c ƒëang b·∫≠t th√¨ ti·∫øp t·ª•c ph√°t
        if (isMusicPlaying) { 
            backgroundMusic.play().catch(e => console.log('Music play resumed.'));
        }
        loadQuestion();
      });
    }

    loadQuestion();
    updateMusicToggleButton(); // C·∫≠p nh·∫≠t bi·ªÉu t∆∞·ª£ng loa ban ƒë·∫ßu
  </script>
</body>
</html>